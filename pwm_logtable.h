#include <avr/pgmspace.h>

#define PWM_LOG(a) (pgm_read_word_near(pwm_table + a))

/**
 * These values are a part of the sRGB transform / reverse companding.
 * 
 * For any component X (X in {0..1}), you compute Xl (component X,
 * linear wrt energy) with this simple formula:
 * 
 *    Xl = X/12.92               (for X <= 0.04045)
 *    Xl = ((X+0.055)/1.055)^2.4 (for X >  0.04045)
 * 
 * And that's it.
 * 
 * Careful, though, that this table is for reverse 16-bit PWM.
 * In the table below, the index 0 value corresponds to absence
 * of color. The 16 bit value 65535 at index 0 corresponds to the
 * match value that should be applied for inverse PWM at this
 * color value, ie "fully off"
 * 
 * Reference: http://www.brucelindbloom.com/index.html?Eqn_RGB_to_XYZ.html
 * 
*/

PROGMEM const uint16_t pwm_table[] = {
	65535,	65515,	65495,	65475,	65455,	65436,	65416,	65396,
	65376,	65356,	65336,	65316,	65294,	65271,	65247,	65222,
	65195,	65168,	65139,	65108,	65077,	65044,	65009,	64973,
	64936,	64898,	64858,	64817,	64774,	64730,	64684,	64637,
	64588,	64538,	64487,	64434,	64379,	64323,	64265,	64205,
	64144,	64082,	64018,	63952,	63884,	63815,	63745,	63672,
	63598,	63522,	63445,	63365,	63285,	63202,	63117,	63031,
	62943,	62854,	62762,	62669,	62574,	62477,	62378,	62277,
	62175,	62071,	61965,	61857,	61747,	61635,	61521,	61406,
	61288,	61169,	61047,	60924,	60799,	60671,	60542,	60411,
	60278,	60143,	60005,	59866,	59725,	59582,	59436,	59289,
	59140,	58988,	58835,	58679,	58521,	58361,	58200,	58035,
	57869,	57701,	57531,	57358,	57183,	57007,	56827,	56646,
	56463,	56277,	56090,	55900,	55707,	55513,	55316,	55118,
	54916,	54713,	54507,	54300,	54089,	53877,	53662,	53445,
	53226,	53005,	52781,	52555,	52326,	52095,	51862,	51626,
	51389,	51148,	50906,	50661,	50413,	50164,	49912,	49657,
	49400,	49141,	48879,	48615,	48348,	48079,	47808,	47534,
	47258,	46979,	46698,	46414,	46128,	45839,	45548,	45254,
	44958,	44659,	44358,	44054,	43748,	43439,	43128,	42814,
	42497,	42178,	41857,	41533,	41206,	40877,	40545,	40210,
	39873,	39534,	39191,	38847,	38499,	38149,	37796,	37441,
	37083,	36722,	36359,	35993,	35624,	35253,	34879,	34502,
	34123,	33741,	33356,	32968,	32578,	32185,	31790,	31392,
	30991,	30587,	30180,	29771,	29359,	28944,	28527,	28106,
	27683,	27257,	26829,	26397,	25963,	25526,	25086,	24644,
	24198,	23750,	23299,	22845,	22388,	21929,	21466,	21001,
	20533,	20062,	19588,	19112,	18632,	18150,	17664,	17176,
	16685,	16191,	15694,	15194,	14691,	14186,	13677,	13166,
	12651,	12134,	11614,	11090,	10564,	10035,	9503,	8968,
	8430,	7889,	7345,	6798,	6248,	5695,	5139,	4580,
	4018,	3453,	2885,	2314,	1740,	1163,	583,	0
};
